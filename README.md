# FriendsService

## Запуск проекта
0. Клонировать проект

### Docker-compose
1. Перейти в корень проекта, после чего собрать и запустить контейнеры при помощи:
    ```bash
    docker-compose build
    ```
    ```bash
    docker-compose up -d
    ```

### Для локального запуска без контейнеров:
1. Установить пакетный менеджер [poetry](https://python-poetry.org/)
2. Перейти в корень проекта
3. Установить зависимости:
    ```bash
   poetry install --without dev
    ```
4. Предполагается, что у Вас уже есть развернутая БД `PostgreSQL`, далее необходимо применить миграции:
    ```bash
   poetry run ./manage.py migrate
    ```
5. И запустить сервер:
    ```bash
   poetry run ./manage.py runserver 0.0.0.0:8000
    ```

## Описание процесса взаимодействия с API
1. Перед использованием API необходимо зарегистрировать пользователя (или нескольких). Сделать это можно при помощи 
    отправки `POST` запроса на метод `http://{host}:8000/api/v1/user/create/`, где:
   * **host** - адрес хоста, на котором запущен сервер

   Тело запроса должно содержать следующие данные:
      * `username` - имя пользователя
      * `password` - пароль пользователя
   
   Если пользователь будет создан успешно, вы получите пустой ответ с `status_code=200`. В случае ошибки
   будет отправлен ответ со `status_code=400` и телом, содержащим описание возникших ошибок по ключу `error`
2. После создания пользователя, необходимо получить `access_token`, для этого необходимо отправить `POST` запрос на
   метод `http://{host}:8000/api/v1/token/`. Тело запроса точно также должно содержать имя пользователя и пароль в формате, указанном в `п.1`

   В результате успешного выполнения, в ответе придет словарь с `access_token` и `refresh_token`. 

   Для выполнения запросов необходимо подставлять полученный `access_token` в заголовки запросов как `Authorization: Bearer {access_token}`

После корректного выполнения вышеописанных пунктов, с полученным `access_token` можно отправлять запросы на остальные методы API.

## Описание доступных методов API
Все методы далее будут описаны относительно `http://{host}:8000`

### Добавление пользователя в друзья
* **Метод**: `POST`
* **url**: `/api/v1/user/add_to_friends/`
* **Тело запроса**:
  * `username`
* **Ответ в случае успеха**: 200

### Посмотреть список отправленных запросов
* **Метод**: `GET`
* **url**: `/api/v1/user/friendship/sent/`
* **Ответ**: список запросов
  ```json
  [
    {
      "id": 0,
      "recipient": "some_user"
    }
  ]
   ```
  где `id` - идентификатор запроса, `recipient` - юзернейм получателя

### Посмотреть список полученных запросов
* **Метод**: `GET`
* **url**: `/api/v1/user/friendship/received/`
* **Ответ**: список запросов
  ```json
  [
    {
      "id": 0,
      "sender": "some_user"
    }
  ]
   ```
  где `id` - идентификатор запроса, `sender` - юзернейм отправителя

### Принять запрос на добавление в друзья
* **Метод**: `GET`
* **url**: `/api/v1/user/friendship/{friendship_id}/accept/`
  где `friendship_id` - идентификатор запроса, полученный ранее
* **Ответ в случае успеха**: 200

### Отклонить запрос на добавление в друзья
* **Метод**: `GET`
* **url**: `/api/v1/user/friendship/{friendship_id}/decline/`
  где `friendship_id` - идентификатор запроса, полученный ранее
* **Ответ в случае успеха**: 200

### Получить список друзей
* **Метод**: `GET`
* **url**: `/api/v1/user/friends/`
* **Ответ в случае успеха**: список юзернеймов друзей
    ```json
    [
      "user1",
      "user2",
      ...
    ]
    ```

### Получить статус дружбы с пользователем
* **Метод**: `GET`
* **url**: `/api/v1/user/friendship/{username}/`
* **Ответ в случае успеха**: 
    ```json
    {
      "message": "message_text"
    }
    ```
    где `message_text` - один из вариантов:
  * `Not found active friendship with {target_username}` - нет активной заявки на дружбу с пользователем
  * `In friends list` - пользователь находится в списке друзей
  * `You have active friends request from {self.target_username}` - имеется активный **входящий** запрос на дружбу от пользователя
  * `You have active friends request to {self.target_username}` - имеется активный **исходящий** запрос на дружбу с пользователем

### Удалить пользователя из друзей
* **Метод**: `DELETE`
* **url**: `/api/v1/user/friendship/{username}/`
* **Ответ в случае успеха**: 200